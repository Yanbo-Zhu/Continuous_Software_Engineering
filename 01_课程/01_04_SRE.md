

# 1 SRE 应该关注的 Software Quality 

Reliability – continuity of correct service
Availability – readiness of correct service



# 2 SLIs, SLOs, SLAs


To manage a service and ensure it meets a certain quality, we need to understand which behaviors really matter for that service and how to measure and evaluate those behaviors.


Service Levels
- Service Level Indicators (SLIs): quantitative measure of one dimension of service quality  (定义某个metric)
- Service Level Objectives (SLOs): a target value or range of values for a SLI  (定义这个 metric 的一些value )
- Service Level Agreements (SLAs): contract with a customer about consequences of meeting (or missing) SLOs

Choosing SLIs
▪ What Do You and Your Users Care About?
▪ You shouldn’t use every metric you can
▪ Must be measurable
▪ User-facing: availability, latency, and throughput
▪ Storage: latency, availability, and durability
▪ Big data systems: throughput and end-to-end latency

## 2.1 Example

> 分布式计算中，远程过程调用（英语：Remote Procedure Call，RPC）是一个计算机通信协议。该协议允许运行于一台计算机的程序调用另一个地址空间（通常为一个开放网络的一台计算机）的子程序，而程序员就像调用本地程序一样，无需额外地为这个交互作用编程（无需关注细节）。RPC是一种服务器-客户端（Client/Server）模式，经典实现是一个通过发送请求-接受回应进行信息交互的系统。

1. Define Performance SLOs
• 90% of Get RPC calls will complete in less than 1 ms
• 99% of Get RPC calls will complete in less than 10 ms
• 99.9% of Get RPC calls will complete in less than 100 ms
• 95% of throughput clients’ Set RPC calls will complete in < 1 s
• 99% of latency clients’ Set RPC calls with payloads < 1 kB will complete in < 10 ms

2. Derive SLIs
• Latency
− Grouped by request type
− Grouped by request type and client type
− Grouped by request type and client type and payload size

3. Set up Monitoring, Dashboard, Alerts…
• Margin of error: 10 seconds and 10%

4. Define actionable consequence – what happens if a SLO is violated?


# 3 Reliability 

Ability of a system to function without failure

## 3.1 Reliability Metrics

Nowadays it is more common is to see it defined through time-based metrics:
- MTTF – Mean-time-to-Failure
- MTBF – Mean-time-between-Failures
- MTTA – Mean-time-to-Alert / Detect
- MTTD – Mean-time-to-Diagnose
- MTTR – Mean-time-to-Repair
- MTTR – Mean-time-to-Restore/Recover


![](image/Pasted%20image%2020241109154743.png)


𝐴𝑣𝑎𝑖𝑙𝑎𝑏𝑖𝑙𝑖𝑡𝑦 = 𝑈𝑝𝑡𝑖𝑚𝑒/ (𝑈𝑝𝑡𝑖𝑚𝑒 + 𝐷𝑜𝑤𝑛𝑡𝑖𝑚𝑒)



# 4 Designing for Reliability

## 4.1 Strategies 
设置这些来prevent failure 

Timeouts:
• All calls to external services are configured with timeouts.
• A call might time out due a number of reasons, e.g. temporary issues (transient networking problems or the server being overloaded), or more permanent issues (bad code push)

Retries:
• When failures are either transient or isolated to a specific instance, it means that a retry to a different instance can often resolve the situation.
• However, not all problems are transient: if a bad code push results in a downstream service being in a bad state (e.g., returning errors for all requests), then a retry will not resolve the situation.

Fallbacks:
• Fallbacks enable the system to degrade gracefully when encountering less temporary issues  系统退化使得符合他的需求 
• For example, if we cannot suggest recommended items that are personalized for an individual user, we can fall back by serving a row of recommended items that are not personalized (e.g., top selling items in the shop)


## 4.2 Cascading Failures的情况 使用什么策略 

A cascading failure is a failure that grows
It can occur when a portion of an overall system fails, increasing the probability that other portions of the system fail.


Approaches to prevent cascading failures:
• Circuit Breaker Pattern
• Load Shedding

---


Circuit Breaker Pattern
![](image/Pasted%20image%2020241109160028.png)

circuit breaker 在第三次的时候 就已经知道上次的 出现了 timeout , 所以这次retry 了一次 
circuit breaker 在第四次的时候 就已经知道上一次retry也没有用了,  所以这次干脆不试了 


---

Load Shedding (掉毛)

Load shedding = drop some requests in an overload situation

Netflix Example:
Netflix prioritizes all incoming requests
• NON_CRITICAL, DEGRADED_EXPERIENCE, CRITICAL
• Prioritize critical requests, i.e. those that are required for video playback

Load-balancing infrastructure (Netflix: Zuul) can drop pending requests in the queue
• Backend-services are monitored by throughput and error rate: if threshold percentages are crossed, requests to specific services are throttled
• If load-balancer itself is overloaded, throttle all requests
• Always drop low-priority requests first





# 5 Processes for Reliability

## 5.1 Immutable Infrastructure


Immutable Infrastructure means no incremental changes to a running application’s context
▪ If a change is required, kill the whole environment and recreate new ones with changes
▪ No “logging in to production”
▪ Servers/VMs are “cattle, not pets”


Typically combined with IaC
▪ Re-create environment based on recipe

![](image/Pasted%20image%2020241109160608.png)


## 5.2 Roll-out Strategies for Continuous Deployment

Continuous Deployment requires automated backup or roll-back, if something goes wrong
▪ The faster a roll-back possible, the better
▪ Transactional configuration of infrastructure, i.e. every configuration change to the system is kept in a log and can be reproduced if something goes wrong

Consider possible conflicts and compatibility
▪ E.g. can the same client, in parallel, use both v1 and v2? Is the client aware of this? What about
consistency in the database if that happens?

Because releases are frequent, a downtime during release is generally not acceptable
▪ Consider additionally required resources to avoid bottlenecks
▪ Roll-out strategies can incorporate testing approaches

Basic Roll-out: Gradual/Incremental Roll-out
![](image/Pasted%20image%2020241109160741.png)


Advanced Roll-out Strategies

![](image/Pasted%20image%2020241109160813.png)


# 6 Reliability Experiments: Chaos Engineering

就是 造极端情况下的  test scanrio 


Goal: harden the system by forcing it to handle failures regularly
Initial idea: randomly terminate virtual machines to make sure the system can handle failures

Chaos Engineering is the discipline of experimenting on a system in order to build confidence in the system’s capability to withstand turbulent conditions in production.


## 6.1 Examples of “Chaos”

Stopped/killed resources
▪ Container, VM, load balancer
▪ Database or service instances
▪ Entire datacenter regions

Emulate noisy neighbors (use many ressource), i.e. an unrelated process running out of control
▪ CPU utilization
▪ Memory/network starvation

Bad network connectivity
▪ Low-level: packet loss
▪ Application-level: high latency, erroneous responses

Malicious actors: denial of service

